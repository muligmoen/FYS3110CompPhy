\documentclass[11pt,a4paper,draft]{article}
\usepackage[english]{babel} % Using babel for hyphenation
\usepackage{lmodern} % Changing the font
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}


\usepackage[colorlinks=true]{hyperref}
\usepackage{cleveref}

%\usepackage[moderate]{savetrees} % [subtle/moderate/extreme] really compact writing
\usepackage{framed}
\usepackage{tcolorbox}
\tcbuselibrary{hooks}
\usepackage[parfill]{parskip} % Removes indents
\usepackage{amsmath} % Environment, symbols etc...
\usepackage{amssymb}
\usepackage{float} % Fixing figure locations
\usepackage{multirow} % For nice tables
%\usepackage{wasysym} % Astrological symbols
\usepackage{graphicx} % For pictures etc...
\usepackage{enumitem} % Points/lists
\usepackage{physics} % Typesetting of mathematical physics examples: 
                     % \bra{}, \ket{}, expval{}
\usepackage{url}


\usepackage{caption}
\usepackage{subcaption}

\definecolor{red}{RGB}{255,10,10}

% To include code(-snippets) with æøå
\usepackage{listings}
\lstset{
language=c++,
showspaces=false,
showstringspaces=false,
frame=l,
}

\tolerance = 5000 % Bedre tekst
\hbadness = \tolerance
\pretolerance = 2000

\numberwithin{equation}{section}

\newcommand{\conj}[1]{#1^*}
\newcommand{\ve}[1]{\mathbf{#1}} % Vektorer i bold
\let\oldhat\hat
\renewcommand{\hat}[1]{\oldhat{#1}}
\newcommand{\trans}[1]{#1^\top}
\newcommand{\herm}[1]{#1^\dagger}

\newcommand{\Real}{\mathbb{R}}
\newcommand{\bigO}[1]{\mathcal{O}\left( #1 \right)}

\newcommand{\di}{\mathrm{d}}
\newcommand{\magM}{\mathcal{M}}

\newcounter{algcounter}
\renewcommand{\thealgcounter}{\Roman{algcounter}}

\newenvironment{algorithm}{%
\refstepcounter{algcounter}
\begin{tcolorbox}
\centerline{Algorithm \thealgcounter}\vspace{2mm}
}
{\end{tcolorbox}}

\newcommand{\figurewidth}{.85\textwidth}

\title{FYS3150/4150\\Computational Physics\\Project 4}
\author{Magnus Ulimoen \& Krister Stræte Karlsen\\
Candidate numbers 33 \& 63}
\date{\today}

\begin{document}
\tcbset{before app=\parfillskip0pt}
\maketitle

\section{Mathematical problem}

\begin{gather}
\frac{\partial u}{\partial t} = D\nabla^2u
\end{gather}
One dimensional,
\subsection{Boundary conditions}
Interval $x \in (0, d)$
\begin{align}
u(0,t) &= u_0\\
u(d,t) &= 0\\
u(x,0) &= 0
\end{align}

\subsection{Scaling}

To shrink the range of x, we introduce the length scaling,
\begin{gather}
\tilde{x} = \frac{x}{d}
\end{gather}
And a time scaling
\begin{gather}
\tilde{t} = t\frac{D}{d^2}
\end{gather}
And scaling the function
\begin{gather}
\tilde{u}(x,t) = \frac{u(x,t)}{u_0}
\end{gather}
Our equation then takes the simple form
\begin{gather}
\frac{\partial \tilde{u}}{\partial \tilde{t}}
= \frac{\partial \tilde{u}^2}{\partial \tilde{x}^2}\\
0 \le \tilde{x} \le 1\\
\tilde{u}(0,\tilde{t})
= 1, \quad \tilde{u}(1,\tilde{t}) = 0, \quad \tilde{u}(\tilde{x}, 0 ) = 0
\end{gather}
In the next sections we will drop the tilde and work with the 
dimensionless parameters.





\section{Closed form}
In steady state
\begin{gather}
\frac{\partial^2 u_s}{\partial x^2} = 0\\
u_s(x) = Ax + b\\
u_s(0) \to b = 1, \quad
u_s(1) \to A = -1\\
u_s(x) = 1-x
\end{gather}
Defining new non-steady solution
\begin{gather}
v(x,t) = u(x,t) - u_s(x)\\
v(x,0) = -u_s(x)\\
v(0,t) = 0, \quad v(1, t) = 0
\end{gather}


\section{Discretisation}

Let the spatial domain $x \in [0,d]$ be sampled at $L+1$ points, $x_0,x_1,..,x_i,..,x_L$ and the time be discretized as $t_0,t_1,..,t_n,..,t_N$. Then we denote the solution, $u(x_i,t_n)$, as $u_i^n$.  

\subsection{Explicit forward Euler}

\begin{gather}
u_i^{n+1} = u_i^n + \frac{\Delta t}{\Delta x^2}\left(
u_{i+1}^n - 2u_i^n + u_{i-1}^n
\right)
\end{gather}
In matrix
\begin{gather}
u^{n+1} = 
\begin{pmatrix}
1 - 2s & s & 0 & 0\\
s & 1 - 2s & s & 0\\
0 & s & 1-2s & s
\end{pmatrix}u^n
\end{gather}



\subsection{Implicit backward Euler}

Using a backward discretization of the time-derivative we obtain the following finite difference approximation of the diffusion equation:
\begin{align*}
\frac{u_{i}^{n}-u_{i}^{n-1}}{\Delta t} = \frac{u_{i-1}^{n}-2u_{i}^{n}+u_{i+1}^{n}}{\Delta x^2}
\end{align*}
Moving all unknowns to the left hand side and defining $\alpha = \frac{\Delta t}{\Delta x^2}$ we get
\begin{align*}
-\alpha u_{i-1}^n + (1+2\alpha)u_i^n - \alpha u_{i+1}^n = u_i^{n-1}. 
\end{align*}
Let's say we have only five spatial mesh points and Dirichlet boundary conditions, $u(0)=D_0$ and $u(d)=D_1$ , then all the equations reads
\begin{align*}
u_0^n &= D_0 \\
-\alpha u_{0}^n + (1+2\alpha)u_1^n - \alpha u_{2}^n &= u_1^{n-1} \\
-\alpha u_{1}^n + (1+2\alpha)u_2^n - \alpha u_{3}^n &= u_2^{n-1} \\
-\alpha u_{2}^n + (1+2\alpha)u_3^n - \alpha u_{4}^n &= u_3^{n-1} \\
u_L^n &= D_1 
\end{align*}
This now should be recognized as a matrix system on the from, $Au=b$ for 

\begin{align*}
\begin{pmatrix} 1 & 0 & \dots   & \dots         & 0 \\
                -\alpha & 1+2\alpha & -\alpha & 0           &0 \\
        \dots  & \ddots & \ddots & \ddots         & \dots\\
 0   & \dots &  -\alpha & 1+2\alpha & -\alpha \\
 0   & \dots & \dots & \dots    &  1
             \end{pmatrix}
\begin{pmatrix} D_0 \\
      u_1^{n-1} \\
      u_2^{n-1}\\ \dots\\ u_{L-1}^{n-1}\\
      D_1
\end{pmatrix} 
=  \begin{pmatrix} u_0^n \\
                   u_1^n  \\
           \dots\\ \dots\\ \dots\\
                   u_L^n 
             \end{pmatrix} 
\end{align*} 

\subsection{Implicit Crank-Nicolson}
\begin{gather}
u_i^{n+1} = u_i^n + \frac{\Delta t}{2\Delta x^2}\left(
u_{i+1}^n - 2u_i^n + u_{i-1}^n + u_{i+1}^{n+1} - 2u_i^{n+1} + u_{i-1}^{n+1}
\right)
\end{gather}
In matrix
\begin{gather}
u^{n+1} = u^n + \frac{\Delta t}{2\Delta x^2}
\begin{pmatrix}
-2 & 1 & 0\\
1 & -2 & 1\\
0 & 1 & -2
\end{pmatrix} u^n
 + \frac{\Delta t}{2\Delta x^2}
\begin{pmatrix}
-2 & 1 & 0\\
1 & -2 & 1\\
0 & 1 & -2
\end{pmatrix}u^{n+1}\\
\begin{pmatrix}
1 + 2s & -s & 0 & 0\\
-s & 1 + 2s & -s & 0\\
0 & -s & 1 + 2s & -s
\end{pmatrix}
u^{n+1} = 
\begin{pmatrix}
1 - 2s & s & 0 & 0\\
s & 1 - 2s & s &  0\\
0 & s & 1 - 2s & s
\end{pmatrix}u^n
\end{gather}


\section{Sparse matrix}
The matrices encountered in the solvers are very sparse, with the same 
diagonal element and off-diagonals. In order to maximize performance 
we implement solvers for the necessary operations.

There are two methods implemented for each method, one inplace and one 
to a new vector

\subsection{Multiplication}
\begin{equation}
d = Au =
\begin{pmatrix}
a & b & 0 & 0\\
b & a & b & 0\\
0 & b & a & b
\end{pmatrix}u
\end{equation}

\begin{algorithm}
\begin{enumerate}[label=\bfseries \arabic*)]
\item Get initial vector u, and the numbers a and b
\item Allocate a new vector d
\item make a loop over all but the ends,
\begin{gather*}
d_i = bu_{i-1} + au_i + bu_{i+1}
\end{gather*}
\item Take care of the ends, 
\begin{align*}
 d_1 = au_1 + bu_2\\
 d_n = bu_{n-1} + au_n
\end{align*}
\end{enumerate}
\end{algorithm}

For inplace
\begin{algorithm}
\begin{enumerate}[label=\bfseries \arabic*)]
\item Get initial vector u, and the numbers a and b
\item Make a loop which saves $u_{prev}$
\begin{align*}
u_{prev} &= u_i\\
u_1 &= u_1*a + u_2*b\\
\text{Loop over i not ends}\\
u_{temp} &= u_i\\
u_i &= bu_{prev} + au_i + bu_{i+1}\\
u_{prev} &= u_{temp}
\end{align*}
\begin{gather*}
u_n = bu_{prev} + au_n
\end{gather*}
\end{enumerate}
\end{algorithm}

\subsection{Inverse matrix multiplication}
We have the equation 
\begin{gather}
d = Au
\end{gather}
with d and A known, where A is a supersparse matrix. Adapting the 
tridiagonal matrix algorithm from project 1,
\begin{algorithm}
\begin{enumerate}[label=\bfseries \arabic*)]
\item 
\end{enumerate}
\end{algorithm}



\end{document}